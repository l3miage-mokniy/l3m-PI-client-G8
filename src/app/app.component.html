<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<mat-toolbar>
  <button mat-icon-button class="example-icon" aria-label="Menu">
    <mat-icon (click)="drawer.toggle()">menu</mat-icon>
  </button>
  <label> Projet intégrateur </label>
  <label class="spacer"></label>
  <ng-template #showLogin>
    <mat-icon [matMenuTriggerFor]="menuConnect"> account_circle </mat-icon>
  </ng-template>
  <mat-icon *ngIf="obsLogin | async as user; else showLogin" [matMenuTriggerFor]="menuDisconnect">
    <img src={{user.photoURL}}/>
  </mat-icon>
  <mat-menu #menuConnect="matMenu">
    <button (click)="login()" mat-menu-item>
      <img [src]="dataIconGoogle" width="24" height="24" />
      &nbsp;
      <span>Compte Google</span>
    </button>
  </mat-menu>
  <mat-menu #menuDisconnect="matMenu">
    <button (click)="logout()" mat-menu-item>
      <mat-icon>logout</mat-icon>
      <span>Déconnexion</span>
    </button>
  </mat-menu>
</mat-toolbar>

<mat-drawer-container class="example-container">
  <mat-drawer #drawer [mode]="mode.value">
    <button>Défis</button><br/>
    <button>Visites</button><br/>
    <button>Mes défis</button><br/>
    <button>Mes visites</button><br/>
  </mat-drawer>
  <mat-drawer-content>
    <mat-form-field>
      <button></button>
      <mat-label>Sidenav mode</mat-label>
      <mat-select #mode value="push">
        <mat-option value="side">Side</mat-option>
        <mat-option value="over">Over</mat-option>
        <mat-option value="push">Push</mat-option>
      </mat-select>
    </mat-form-field>

    <!--COMPOSANT MAP-->
    <app-map></app-map>

    <div class="container">
    <section *ngIf="obsUser | async as OneUser">
      <section *ngIf="OneUser.chami === undefined">
        <br />
        <br />
        <h1 style="text-align: center">
          Bienvenue {{ OneUser.oauthUser.displayName }} ! Veuillez terminer l'inscription.
        </h1>
        <div class="alert alert-danger" role="alert">
          <b>Bienvenue sur le site des Chamis ! Veuillez saisir votre âge pour confirmer votre inscription avec l'email : {{ OneUser.oauthUser.email }}</b>
          <br/>
          <br/>
        <form (ngSubmit)="
            createUser(
              InputName.value,
              InputAge.value,
              InputVille.value,
              InputDescription.value
            )
          " >
          <div class="form-row">
            <div class="form-group col-md-6">
              <label>Age : </label>
              <input #InputAge class="form-control" name="InputAge" type="number" placeholder="Age"/>
            </div>
            <div class="form-group col-md-6" >
              <label>Ville : </label>
              <input #InputVille class="form-control" name="InputVille" type="text" placeholder="Ville"/>
            </div>
          </div>
          <div class="form-group">
            <label>Description : </label>
            <textarea #InputDescription class="form-control" id="exampleFormControlTextarea1" rows="3" placeholder="Description"></textarea>
          </div>
          <input hidden #InputName name="InputName" type="text" value="{{ OneUser.oauthUser.email }}" />
          <input class="btn btn-secondary" type="submit" />
          <!--<button (click)="createUserV2(InputName.value,InputAge.value)">SUBMIT AVEC BUTTON</button>-->
        </form>
      </div>
      <br />
      </section>

        <section *ngIf="OneUser.chami !== undefined">
          <app-crea-defi [userConnected]="OneUser.chami" ></app-crea-defi>
        <br />
        <br />
          <h1 style="text-align: center">
            Bienvenue {{ OneUser.oauthUser.displayName }} !
          </h1>
          <hr />
          <h4>Mise à jour des informations du profil.</h4>
          <form (ngSubmit)="
              updateUser(
                InputAge.value,
                InputVille.value,
                InputDescription.value,
                InputMail.value
              )
            ">
            <div class="form-row">
              <div class="form-group col-md-6">
                <label>Age : </label>
                <input #InputAge class="form-control" name="InputAge" type="number" placeholder="Age"
                  value="{{ OneUser.chami.age }}" />
              </div>
              <div class="form-group col-md-6">
                <label>Ville : </label>
                <input #InputVille class="form-control" name="InputVille" type="text" placeholder="Ville"
                  value="{{ OneUser.chami.ville }}" />
              </div>
            </div>
            <div class="form-group">
              <label>Description : </label>
              <textarea #InputDescription class="form-control" id="exampleFormControlTextarea1"
                value="{{ OneUser.chami.description }}" rows="3"></textarea>
            </div>
            <input hidden #InputMail name="InputMail" type="text" value="{{ OneUser.oauthUser.email }}" />
            <input class="btn btn-secondary" type="submit" />
          </form>
          <hr />
            <h4>Voici vos défis, pour en modifier un il suffit de cliquer dessus !</h4>
            <table class="table" *ngIf="obsChallUser | async as Defis" class="table">
              <thead class="thead-dark">
                <tr>
                  <th>Defi</th>
                  <th>titre</th>
                  <th>description</th>
                  <th>auteur</th>
                  <th>dateCreation</th>
                </tr>
              </thead>
              <tbody>
                <tr (click)="editedModeForDefi(Defi)" *ngFor="let Defi of Defis">
                  <td>{{ Defi.defi }}</td>
                  <td>{{ Defi.titre }}</td>
                  <td>{{ Defi.description }}</td>
                  <td>{{ Defi.auteur }}</td>
                  <td>{{ Defi.dateDeCreation }}</td>
                </tr>
              </tbody>
            </table>

            <!--METTRE EN PLACE DES PARTIALS-->
            <!--METTRE EN PLACE LIST ARRET-->
            <section *ngIf="defi_edited !== null">
              <form (ngSubmit)="updateDefi(defi_edited.defi,titreDefi.value,defi_edited.dateDeCreation, descriptionDefi.value,defi_edited.auteur,defi_edited.code_arret,defi_edited.type, versionDefi.value,defi_edited.arret, pointsDefi.value, dureeDefi.value, prologueDefi.value, epilogueDefi.value, commentaireDefi.value)">
                <hr />
                <h3 style="text-align: center;"><b>Edition du défi : {{ defi_edited.defi }}</b></h3>
                <div class="form-row">
                <div class="form-group col-md-6">
                  <label>Titre : </label>
                  <input #titreDefi class="form-control" name="titreDefi" type="text" placeholder="Titre" value="{{ defi_edited.titre }}" />
                </div>
                </div>
                <div class="form-group">
                  <label>Description : </label>
                  <textarea #descriptionDefi class="form-control" name="InputDescription" value="{{ defi_edited.description }}" rows="3"></textarea>
                </div>

                <div class="form-row">
                  <div class="form-group col-md-6">
                    <label>Version : </label>
                    <input #versionDefi class="form-control" name="versionDefi" type="number" placeholder="Version" value="{{ defi_edited.version }}"  />
                  </div>
                  <div class="form-group col-md-6">
                    <label>Points : </label>
                    <input #pointsDefi class="form-control" name="pointsDefi" type="number" placeholder="Points" value="{{ defi_edited.points }}" />
                  </div>
                  <div class="form-group col-md-6">
                    <label>Durée : </label>
                    <input #dureeDefi class="form-control" name="dureeDefi" type="text" placeholder="Durée" value="{{ defi_edited.duree }}" />
                  </div>
                </div>

                <label>Prologue : </label>
                <textarea #prologueDefi class="form-control" id="exampleFormControlTextarea1" rows="3" value="{{ defi_edited.prologue }}" ></textarea>

                <label>Epilogue : </label>
                <textarea #epilogueDefi class="form-control" id="exampleFormControlTextarea1" rows="3" value="{{ defi_edited.epilogue }}" ></textarea>

                <label>Commentaire : </label>
                <textarea #commentaireDefi class="form-control" id="exampleFormControlTextarea1" rows="3" value="{{ defi_edited.commentaire }}" ></textarea>


                <br/>
                <button class="btn btn-outline-success" type="submit"><i class="fa fa-check "></i>Modifier</button>
              </form>
              <br/>
              <button (click)="deleteDefi(defi_edited)" class="btn btn-outline-danger"><i class="fa fa-trash"></i>Supprimer</button>
            </section>
          <hr />
          <br />
        </section>
      </section>
      <br />

      <h2 style="text-align: center">LES CHAMIS !</h2>
      <button class="btn btn-secondary btn-lg btn-block" (click)="recupUser()">
        RECUPERER LES CHAMIS
      </button>
      <br />
      <table *ngIf="obsChamis | async as users" class="col" class="table">
        <thead class="thead-dark">
          <tr>
            <th>LOGIN</th>
            <th>AGE</th>
            <th>DESCRIPTION</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let User of users">
            <td>{{ User.pseudo }}</td>
            <td>{{ User.age }}</td>
            <td>{{ User.description }}</td>
          </tr>
        </tbody>
      </table>
    </div>
    <br />
    <br />
    <div class="container-fluid">
      <button class="col" (click)="recupDefi()">RECUPERER LES DEFIS</button>
      <br />
      <br />
      <table *ngIf="obsDefis | async as Defis" class="col">
        <thead>
          <tr>
            <th colspan="5">Défis</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <th>Defi</th>
            <th>titre</th>
            <th>description</th>
            <th>auteur</th>
            <th>dateCreation</th>
            <th>code arret</th>
          </tr>
          <tr *ngFor="let Defi of Defis">
            <td>{{ Defi.defi }}</td>
            <td>{{ Defi.titre }}</td>
            <td>{{ Defi.description }}</td>
            <td>{{ Defi.auteur }}</td>
            <td>{{ Defi.dateDeCreation }}</td>
            <td>{{ Defi.code_arret }}</td>
          </tr>
        </tbody>
      </table>
      <br />
      <br />
      <br />
      <button (click)="tstv2()">tst</button>
      new user publie :
      {{ tst | async | json }}
      <br />

      Notre user : {{ obsUser | async | json }}
      <br />
      <br />
      <br />
      <br />
      <br />
      <br />
      <br />
      <br />
    </div>

  </mat-drawer-content>
</mat-drawer-container>
